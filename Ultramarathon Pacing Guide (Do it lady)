from datetime import datetime, date

# Get today's date string
today_str = date.today().strftime('%Y-%m-%d')

# Prompt the user
units = input("Do you want pace in 'Miles' or 'KMs': ")
manual_input = input(f"Press Enter to use current time or enter start time manually (in YYYY-MM-DD HH:MM:SS format):")

if manual_input.strip():
    try:
        input_str = manual_input.strip()
        # If only time is entered
        if len(input_str) == 8 and ':' in input_str:
            input_str = f"{today_str} {input_str}"
        # Try parsing full datetime
        current_datetime = datetime.strptime(input_str, '%Y-%m-%d %H:%M:%S')
        print(f"✅ Using manual start time: {current_datetime.strftime('%Y-%m-%d %H:%M:%S')}")
    except ValueError:
        print("❌ Invalid format. Using current system time instead.")
        current_datetime = datetime.now()
else:
    current_datetime = datetime.now()
    print(f"🕒 Using current system time: {current_datetime.strftime('%Y-%m-%d %H:%M:%S')}")

# Convert to timestamp
current_timestamp = current_datetime.timestamp()


# Define cut-off time and convert to datetime object
cut_off_str = '2025-08-17 10:00:00'
cut_off_datetime = datetime.strptime(cut_off_str, '%Y-%m-%d %H:%M:%S')
cut_off_timestamp = cut_off_datetime.timestamp()
print(f"Cut-off time: {cut_off_datetime.strftime('%Y-%m-%d %H:%M:%S')}")

# Calculate time remaining
time_remaining_seconds = cut_off_timestamp - current_timestamp

if units == 'Miles':
    unit = 'minutes/mile'
elif units == 'KMs':
    unit = 'minutes/kilometer'
else:
    pass

if units == 'Miles':
    distance_unit = 'mile'
elif units == 'KMs':
    distance_unit = 'kilometer'
else:
    pass

if time_remaining_seconds <= 0:
    print("🚫 The cut-off time has already passed!")
else:
    # Get user input for start and end mileage
    start = input(f"What {distance_unit} mark are you starting from?: ")
    end = input(f"What {distance_unit} mark are you ending at?: ")

    try:
        start = float(start)
        end = float(end)
        distance = end - start

        if distance <= 0:
            print("⚠️ End mileage must be greater than start mileage.")
        else:
            # Break time remaining into hours and minutes
            total_minutes_remaining = int(time_remaining_seconds / 60)
            hours_remaining = total_minutes_remaining // 60
            minutes_remaining = total_minutes_remaining % 60
            if units == 'Miles':
                # Calculate pace needed (min/mile)
                pace_needed = total_minutes_remaining / distance
                pace_minutes = int(pace_needed)
                pace_seconds = int((pace_needed - pace_minutes) * 60)
            elif units == 'KMs':
                pace_needed = (total_minutes_remaining / distance)
                pace_minutes = int(pace_needed)
                pace_seconds = int((pace_needed - pace_minutes) * 60)
                
            print(f"""
🏃‍You are running {distance:.2f} {distance_unit}, starting at {distance_unit} {start} and ending at {distance_unit} {end}.
🕒 Time remaining until cut-off: {hours_remaining} hours, {minutes_remaining} minutes
⏱️ Required pace: {pace_minutes}:{pace_seconds:02d} {unit}
✨ Do it, Lady! ✨
""")
    except ValueError:
        print("❌ Please enter valid numbers for start and end mile marks.")
